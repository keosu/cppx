name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  # Linux and macOS builds are currently disabled (MSVC-only project with /Zc:preprocessor)
  # Uncomment when cross-platform support is added
  
  # build-linux:
  #   name: Linux - ${{ matrix.compiler }} - ${{ matrix.mode }}
  #   runs-on: ubuntu-latest
  #   strategy:
  #     fail-fast: false
  #     matrix:
  #       compiler: [gcc-13, clang-17]
  #       mode: [debug, release]
  #   steps:
  #   - uses: actions/checkout@v4
  #   # ... (steps omitted)

  build-windows:
    name: Windows - MSVC - ${{ matrix.mode }}
    runs-on: windows-latest
    strategy:
      fail-fast: false
      matrix:
        mode: [debug, release]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      with:
        arch: x64
    
    - name: Install xmake
      run: |
        Invoke-WebRequest -Uri "https://github.com/xmake-io/xmake/releases/download/v2.8.9/xmake-v2.8.9.win64.exe" -OutFile "xmake-installer.exe"
        Start-Process -FilePath ".\xmake-installer.exe" -ArgumentList "/S" -Wait
        echo "$env:ProgramFiles\xmake" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
    
    - name: Configure
      run: |
        xmake f -m ${{ matrix.mode }} -y -v
    
    - name: Build
      run: xmake -r -v
    
    - name: Run tests
      run: xmake test -v
    
    - name: Build examples
      run: xmake build -g examples -v

  # macOS build is currently disabled (MSVC-only project)
  # Uncomment when cross-platform support is added
  
  # build-macos:
  #   name: macOS - Clang - ${{ matrix.mode }}
  #   runs-on: macos-latest
  #   ... (steps omitted)

  # Code quality checks are disabled for now
  # Re-enable when formatting is standardized
  
  # code-quality:
  #   name: Code Quality Checks
  #   runs-on: ubuntu-latest
  #   steps:
  #   - uses: actions/checkout@v4
  #   - name: Check formatting
  #     run: clang-format --version

